<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no, viewport-fit=cover">
  <title>Pia</title>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    html, body {
      width: 100%;
      height: 100%;
      background: transparent;
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      color: #fff;
      overflow: hidden;
      -webkit-user-select: none;
      user-select: none;
    }
    #app {
      width: 100%;
      height: 100%;
      display: flex;
      align-items: flex-start;
      justify-content: center;
      padding: 10px;
      background: transparent;
    }
    .hidden { display: none !important; }

    .modal {
      width: 100%;
      max-width: 400px;
      background: rgba(30, 30, 32, 0.95);
      -webkit-backdrop-filter: blur(50px) saturate(180%);
      backdrop-filter: blur(50px) saturate(180%);
      border-radius: 14px;
      border: 1px solid rgba(255, 255, 255, 0.12);
      box-shadow:
        0 0 0 0.5px rgba(0, 0, 0, 0.3),
        0 8px 32px rgba(0, 0, 0, 0.4),
        0 2px 8px rgba(0, 0, 0, 0.2);
      overflow: hidden;
    }

    .drag-handle {
      height: 44px;
      cursor: grab;
      background: transparent;
      display: flex;
      align-items: center;
      justify-content: center;
      -webkit-tap-highlight-color: transparent;
      touch-action: none;
    }
    .drag-handle::after {
      content: '';
      width: 36px;
      height: 4px;
      background: rgba(255, 255, 255, 0.2);
      border-radius: 2px;
      transition: all 0.15s;
    }
    .drag-handle:active { cursor: grabbing; }
    .drag-handle:active::after, .drag-handle.touch-active::after { background: rgba(255, 255, 255, 0.4); width: 44px; }

    .modal-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 4px 12px 8px;
    }
    .status-indicator { display: flex; align-items: center; gap: 6px; }
    .status-dot {
      width: 8px;
      height: 8px;
      border-radius: 50%;
      background: rgba(255, 255, 255, 0.4);
    }
    .status-dot.running { background: #32d74b; animation: pulse 1.5s infinite; }
    .status-dot.error { background: #ff453a; }
    .status-dot.completed { background: #0a84ff; }
    @keyframes pulse { 0%, 100% { opacity: 1; } 50% { opacity: 0.5; } }
    .status-text { font-size: 12px; color: rgba(255, 255, 255, 0.6); font-weight: 500; }

    .header-actions { display: flex; gap: 2px; }
    .icon-btn {
      width: 44px;
      height: 44px;
      display: flex;
      align-items: center;
      justify-content: center;
      background: transparent;
      border: none;
      border-radius: 6px;
      color: rgba(255, 255, 255, 0.5);
      cursor: pointer;
      transition: all 0.15s;
      -webkit-tap-highlight-color: transparent;
      touch-action: manipulation;
    }
    .icon-btn:hover { background: rgba(255, 255, 255, 0.1); color: #fff; }
    .icon-btn:active, .icon-btn.touch-active { background: rgba(255, 255, 255, 0.15); color: #fff; transform: scale(0.95); }

    .input-area { display: flex; gap: 8px; padding: 0 12px 12px; }
    #instruction-input {
      flex: 1;
      height: 38px;
      padding: 0 12px;
      background: rgba(255, 255, 255, 0.08);
      border: 1px solid rgba(255, 255, 255, 0.1);
      border-radius: 8px;
      color: #fff;
      font-size: 14px;
      outline: none;
      transition: all 0.15s;
    }
    #instruction-input::placeholder { color: rgba(255, 255, 255, 0.35); }
    #instruction-input:focus {
      background: rgba(255, 255, 255, 0.12);
      border-color: rgba(10, 132, 255, 0.5);
    }
    .submit-btn {
      width: 44px;
      height: 44px;
      display: flex;
      align-items: center;
      justify-content: center;
      background: #0a84ff;
      border: none;
      border-radius: 8px;
      color: #fff;
      cursor: pointer;
      transition: all 0.15s;
      -webkit-tap-highlight-color: transparent;
      touch-action: manipulation;
    }
    .submit-btn:hover { background: #409cff; transform: scale(1.02); }
    .submit-btn:active, .submit-btn.touch-active { background: #006edb; transform: scale(0.95); }
    .submit-btn:disabled { opacity: 0.4; cursor: not-allowed; transform: none; }

    .metrics-bar {
      display: flex;
      justify-content: space-around;
      padding: 8px 12px;
      background: rgba(0, 0, 0, 0.2);
      border-top: 1px solid rgba(255, 255, 255, 0.06);
    }
    .metric { display: flex; flex-direction: column; align-items: center; gap: 1px; }
    .metric-label { font-size: 9px; color: rgba(255, 255, 255, 0.4); text-transform: uppercase; letter-spacing: 0.5px; }
    .metric-value { font-size: 12px; font-weight: 600; color: rgba(255, 255, 255, 0.8); font-variant-numeric: tabular-nums; }

    .action-display { padding: 10px 12px; }
    .action-label { font-size: 9px; color: rgba(255, 255, 255, 0.4); text-transform: uppercase; letter-spacing: 0.5px; margin-bottom: 3px; }
    .action-content { font-size: 11px; color: rgba(255, 255, 255, 0.6); line-height: 1.4; max-height: 40px; overflow-y: auto; }

    .stop-btn {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 6px;
      width: calc(100% - 24px);
      margin: 0 12px 12px;
      padding: 12px;
      min-height: 44px;
      background: rgba(255, 69, 58, 0.9);
      border: none;
      border-radius: 8px;
      color: #fff;
      font-size: 12px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.15s;
      -webkit-tap-highlight-color: transparent;
      touch-action: manipulation;
    }
    .stop-btn:hover { background: #ff453a; }
    .stop-btn:active, .stop-btn.touch-active { background: #cc362e; transform: scale(0.98); }

    /* Settings Panel */
    .settings-panel {
      position: absolute;
      top: 10px;
      left: 0;
      right: 0;
      margin: 0 auto;
      max-width: 380px;
      max-height: calc(100vh - 20px);
      background: rgba(30, 30, 30, 0.9);
      -webkit-backdrop-filter: blur(40px) saturate(180%);
      backdrop-filter: blur(40px) saturate(180%);
      border-radius: 12px;
      border: 1px solid rgba(255, 255, 255, 0.15);
      box-shadow: 0 20px 40px rgba(0, 0, 0, 0.4);
      display: flex;
      flex-direction: column;
      overflow: hidden;
    }
    .settings-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 12px;
      border-bottom: 1px solid rgba(255, 255, 255, 0.08);
    }
    .settings-header h2 { font-size: 14px; font-weight: 600; }
    .settings-content { flex: 1; overflow-y: auto; padding: 12px; }
    .setting-group { margin-bottom: 14px; }
    .setting-label { display: block; font-size: 10px; color: rgba(255, 255, 255, 0.5); margin-bottom: 5px; text-transform: uppercase; letter-spacing: 0.5px; }
    .setting-input, .setting-select {
      width: 100%;
      height: 34px;
      padding: 0 10px;
      background: rgba(255, 255, 255, 0.08);
      border: 1px solid rgba(255, 255, 255, 0.1);
      border-radius: 6px;
      color: #fff;
      font-size: 13px;
      outline: none;
    }
    .setting-input::placeholder { color: rgba(255, 255, 255, 0.3); }
    .setting-input:focus, .setting-select:focus { border-color: rgba(10, 132, 255, 0.5); background: rgba(255, 255, 255, 0.12); }
    .setting-select { cursor: pointer; appearance: none; }
    .setting-checkbox { display: flex; align-items: center; gap: 8px; cursor: pointer; font-size: 13px; color: rgba(255, 255, 255, 0.8); }
    .setting-checkbox input { width: 16px; height: 16px; accent-color: #0a84ff; }
    .setting-hint { font-size: 10px; color: rgba(255, 255, 255, 0.4); margin-top: 4px; }
    .provider-settings { padding: 10px; background: rgba(0, 0, 0, 0.2); border-radius: 8px; margin-bottom: 14px; }
    .provider-settings .setting-group:last-child { margin-bottom: 0; }
    .save-btn {
      width: 100%;
      padding: 12px;
      min-height: 44px;
      background: #0a84ff;
      border: none;
      border-radius: 8px;
      color: #fff;
      font-size: 13px;
      font-weight: 600;
      cursor: pointer;
      margin-top: 6px;
      -webkit-tap-highlight-color: transparent;
      touch-action: manipulation;
      transition: all 0.15s;
    }
    .save-btn:hover { background: #409cff; }
    .save-btn:active, .save-btn.touch-active { background: #006edb; transform: scale(0.98); }

    .confirmation-dialog {
      position: fixed;
      top: 0; left: 0; right: 0; bottom: 0;
      background: rgba(0, 0, 0, 0.6);
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 100;
    }
    .confirmation-content {
      background: rgba(40, 40, 40, 0.95);
      -webkit-backdrop-filter: blur(20px);
      backdrop-filter: blur(20px);
      border-radius: 12px;
      border: 1px solid rgba(255, 255, 255, 0.1);
      padding: 20px;
      max-width: 280px;
      text-align: center;
    }
    .confirmation-content h3 { font-size: 15px; margin-bottom: 8px; }
    .confirmation-content p { font-size: 12px; color: rgba(255, 255, 255, 0.6); margin-bottom: 16px; }
    .confirmation-actions { display: flex; gap: 8px; justify-content: center; }
    .btn { padding: 12px 20px; min-height: 44px; border-radius: 6px; border: none; font-size: 12px; font-weight: 600; cursor: pointer; -webkit-tap-highlight-color: transparent; touch-action: manipulation; transition: all 0.15s; }
    .btn-cancel { background: rgba(255, 255, 255, 0.1); color: #fff; }
    .btn-cancel:hover { background: rgba(255, 255, 255, 0.15); }
    .btn-cancel:active, .btn-cancel.touch-active { background: rgba(255, 255, 255, 0.2); transform: scale(0.98); }
    .btn-confirm { background: #0a84ff; color: #fff; }
    .btn-confirm:hover { background: #409cff; }
    .btn-confirm:active, .btn-confirm.touch-active { background: #006edb; transform: scale(0.98); }

    ::-webkit-scrollbar { width: 4px; }
    ::-webkit-scrollbar-track { background: transparent; }
    ::-webkit-scrollbar-thumb { background: rgba(255, 255, 255, 0.2); border-radius: 2px; }

    /* Touch gesture support */
    .status-indicator {
      padding: 8px;
      margin: -8px;
      border-radius: 8px;
      transition: all 0.15s;
      -webkit-tap-highlight-color: transparent;
      cursor: pointer;
    }
    .status-indicator.long-press-active {
      background: rgba(255, 255, 255, 0.1);
      transform: scale(1.05);
    }
    .status-indicator.long-press-triggered {
      background: rgba(10, 132, 255, 0.2);
    }

    .action-content {
      padding: 8px;
      margin: -8px;
      border-radius: 6px;
      transition: all 0.15s;
      -webkit-tap-highlight-color: transparent;
      cursor: pointer;
    }
    .action-content.long-press-active {
      background: rgba(255, 255, 255, 0.08);
      transform: scale(1.02);
    }
    .action-content.long-press-triggered {
      background: rgba(50, 215, 75, 0.2);
    }

    /* Settings panel touch support */
    .settings-panel {
      touch-action: pan-y;
    }
    .settings-panel.swipe-closing {
      transition: transform 0.2s ease-out, opacity 0.2s ease-out;
    }

    /* Touch toast notification */
    .toast {
      position: fixed;
      bottom: 20px;
      left: 50%;
      transform: translateX(-50%);
      padding: 10px 20px;
      border-radius: 8px;
      font-size: 13px;
      font-weight: 500;
      z-index: 200;
      animation: toast-in 0.3s ease;
    }
    .toast.success { background: rgba(50, 215, 75, 0.9); color: #fff; }
    .toast.error { background: rgba(255, 69, 58, 0.9); color: #fff; }
    .toast.info { background: rgba(10, 132, 255, 0.9); color: #fff; }
    @keyframes toast-in {
      from { opacity: 0; transform: translateX(-50%) translateY(10px); }
      to { opacity: 1; transform: translateX(-50%) translateY(0); }
    }

    /* Prevent text selection during touch interactions */
    .touch-no-select {
      -webkit-user-select: none;
      user-select: none;
    }

    /* Long-press context hint */
    .context-hint {
      position: fixed;
      padding: 8px 12px;
      background: rgba(0, 0, 0, 0.85);
      border-radius: 6px;
      font-size: 11px;
      color: rgba(255, 255, 255, 0.9);
      pointer-events: none;
      z-index: 150;
      animation: hint-in 0.15s ease;
    }
    @keyframes hint-in {
      from { opacity: 0; transform: scale(0.95); }
      to { opacity: 1; transform: scale(1); }
    }
  </style>
</head>
<body>
  <div id="app">
    <div class="modal" id="main-modal">
      <div class="drag-handle" data-tauri-drag-region></div>
      <div class="modal-header">
        <div class="status-indicator">
          <span class="status-dot"></span>
          <span class="status-text">Ready</span>
        </div>
        <div class="header-actions">
          <button class="icon-btn" id="settings-btn" title="Settings">
            <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <circle cx="12" cy="12" r="3"></circle>
              <path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z"></path>
            </svg>
          </button>
          <button class="icon-btn" id="close-btn" title="Hide">
            <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <line x1="18" y1="6" x2="6" y2="18"></line>
              <line x1="6" y1="6" x2="18" y2="18"></line>
            </svg>
          </button>
        </div>
      </div>
      <div class="input-area">
        <input type="text" id="instruction-input" placeholder="What would you like me to do?" autocomplete="off">
        <button class="submit-btn" id="submit-btn">
          <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5">
            <line x1="22" y1="2" x2="11" y2="13"></line>
            <polygon points="22 2 15 22 11 13 2 9 22 2"></polygon>
          </svg>
        </button>
      </div>
      <div class="metrics-bar">
        <div class="metric">
          <span class="metric-label">Iteration</span>
          <span class="metric-value" id="iteration-value">0/50</span>
        </div>
        <div class="metric">
          <span class="metric-label">Speed</span>
          <span class="metric-value" id="speed-value">--</span>
        </div>
        <div class="metric">
          <span class="metric-label">Tokens</span>
          <span class="metric-value" id="tokens-value">0</span>
        </div>
      </div>
      <div class="action-display">
        <div class="action-label">Last Action</div>
        <div class="action-content" id="action-content">Waiting for instruction...</div>
      </div>
      <button class="stop-btn hidden" id="stop-btn">
        <svg width="12" height="12" viewBox="0 0 24 24" fill="currentColor"><rect x="6" y="6" width="12" height="12" rx="2"></rect></svg>
        Stop
      </button>
    </div>

    <div class="settings-panel hidden" id="settings-panel">
      <div class="settings-header">
        <h2>Settings</h2>
        <button class="icon-btn" id="settings-close-btn">
          <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <line x1="18" y1="6" x2="6" y2="18"></line>
            <line x1="6" y1="6" x2="18" y2="18"></line>
          </svg>
        </button>
      </div>
      <div class="settings-content">
        <div class="setting-group">
          <label class="setting-label">Provider</label>
          <select id="provider-select" class="setting-select">
            <option value="ollama">Ollama (Local)</option>
            <option value="anthropic">Anthropic</option>
            <option value="openai">OpenAI</option>
            <option value="openrouter">OpenRouter</option>
          </select>
        </div>
        <div class="provider-settings" id="ollama-settings">
          <div class="setting-group">
            <label class="setting-label">Host</label>
            <input type="text" id="ollama-host" class="setting-input" placeholder="http://localhost:11434">
          </div>
          <div class="setting-group">
            <label class="setting-label">Model</label>
            <input type="text" id="ollama-model" class="setting-input" placeholder="llava">
          </div>
        </div>
        <div class="provider-settings hidden" id="anthropic-settings">
          <div class="setting-group">
            <label class="setting-label">API Key</label>
            <input type="password" id="anthropic-key" class="setting-input" placeholder="sk-ant-...">
          </div>
          <div class="setting-group">
            <label class="setting-label">Model</label>
            <input type="text" id="anthropic-model" class="setting-input" placeholder="claude-sonnet-4-20250514">
          </div>
        </div>
        <div class="provider-settings hidden" id="openai-settings">
          <div class="setting-group">
            <label class="setting-label">API Key</label>
            <input type="password" id="openai-key" class="setting-input" placeholder="sk-...">
          </div>
          <div class="setting-group">
            <label class="setting-label">Model</label>
            <input type="text" id="openai-model" class="setting-input" placeholder="gpt-4o">
          </div>
        </div>
        <div class="provider-settings hidden" id="openrouter-settings">
          <div class="setting-group">
            <label class="setting-label">API Key</label>
            <input type="password" id="openrouter-key" class="setting-input" placeholder="sk-or-...">
          </div>
          <div class="setting-group">
            <label class="setting-label">Model</label>
            <input type="text" id="openrouter-model" class="setting-input" placeholder="anthropic/claude-sonnet-4-20250514">
          </div>
        </div>
        <div class="setting-group">
          <label class="setting-checkbox">
            <input type="checkbox" id="confirm-dangerous" checked>
            <span>Confirm dangerous actions</span>
          </label>
          <p class="setting-hint">Ask before delete/close operations</p>
        </div>
        <button class="save-btn" id="save-settings-btn">Save</button>
      </div>
    </div>

    <div class="confirmation-dialog hidden" id="confirmation-dialog">
      <div class="confirmation-content">
        <h3>Confirm Action</h3>
        <p id="confirmation-message">This action requires confirmation.</p>
        <div class="confirmation-actions">
          <button class="btn btn-cancel" id="cancel-action-btn">Cancel</button>
          <button class="btn btn-confirm" id="confirm-action-btn">Confirm</button>
        </div>
      </div>
    </div>
  </div>
  <script type="module" src="./src/main.js"></script>
</body>
</html>
