<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="apple-touch-icon" href="/apple-touch-icon.png">
  <link rel="icon" type="image/svg+xml" href="/favicon.svg">
  <link rel="icon" type="image/x-icon" href="/favicon.ico">
  <title>Pia</title>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    html, body {
      width: 100%;
      height: 100%;
      background: transparent;
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      color: #fff;
      overflow: hidden;
      -webkit-user-select: none;
      user-select: none;
    }
    #app {
      width: 100%;
      height: 100%;
      display: flex;
      align-items: flex-start;
      justify-content: center;
      padding: 10px;
      background: transparent;
    }
    .hidden { display: none !important; }

    /* Visually hidden but accessible to screen readers */
    .visually-hidden {
      position: absolute;
      width: 1px;
      height: 1px;
      padding: 0;
      margin: -1px;
      overflow: hidden;
      clip: rect(0, 0, 0, 0);
      white-space: nowrap;
      border: 0;
    }

    .modal {
      width: 100%;
      max-width: 400px;
      background: rgba(30, 30, 32, 0.95);
      -webkit-backdrop-filter: blur(50px) saturate(180%);
      backdrop-filter: blur(50px) saturate(180%);
      border-radius: 14px;
      border: 1px solid rgba(255, 255, 255, 0.12);
      box-shadow:
        0 0 0 0.5px rgba(0, 0, 0, 0.3),
        0 8px 32px rgba(0, 0, 0, 0.4),
        0 2px 8px rgba(0, 0, 0, 0.2);
      overflow: hidden;
      transition: box-shadow 0.15s ease, transform 0.15s ease, opacity 0.15s ease;
    }

    .drag-handle {
      height: 28px;
      cursor: grab;
      background: transparent;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: background 0.15s ease;
    }
    .drag-handle::after {
      content: '';
      width: 36px;
      height: 4px;
      background: rgba(255, 255, 255, 0.2);
      border-radius: 2px;
      transition: all 0.15s ease;
    }
    .drag-handle:hover::after {
      background: rgba(255, 255, 255, 0.35);
      width: 40px;
    }
    .drag-handle:active { cursor: grabbing; }

    /* Dragging state visual feedback */
    .modal.dragging {
      box-shadow:
        0 0 0 0.5px rgba(0, 0, 0, 0.3),
        0 12px 40px rgba(0, 0, 0, 0.5),
        0 4px 12px rgba(0, 0, 0, 0.3),
        0 0 0 1px rgba(10, 132, 255, 0.2);
      transform: scale(1.01);
      opacity: 0.95;
    }
    .modal.dragging .drag-handle {
      background: rgba(255, 255, 255, 0.03);
    }
    .modal.dragging .drag-handle::after {
      background: rgba(10, 132, 255, 0.6);
      width: 44px;
      height: 5px;
    }

    .modal-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 4px 12px 8px;
    }
    .status-indicator { display: flex; align-items: center; gap: 6px; }
    .pia-logo {
      width: 24px;
      height: 24px;
      flex-shrink: 0;
    }
    .status-dot {
      width: 8px;
      height: 8px;
      border-radius: 50%;
      background: rgba(255, 255, 255, 0.4);
      transition: background-color 0.3s ease, box-shadow 0.3s ease;
    }
    .status-dot.running {
      background: #32d74b;
      animation: pulse-soft 2s ease-in-out infinite;
      box-shadow: 0 0 8px rgba(50, 215, 75, 0.4);
    }
    .status-dot.error {
      background: #ff453a;
      animation: flash-error 0.5s ease-out;
      box-shadow: 0 0 8px rgba(255, 69, 58, 0.4);
    }
    .status-dot.completed {
      background: #0a84ff;
      animation: flash-success 0.5s ease-out;
      box-shadow: 0 0 8px rgba(10, 132, 255, 0.4);
    }
    .status-dot.retrying {
      background: #ff9f0a;
      animation: pulse-soft 1s ease-in-out infinite;
      box-shadow: 0 0 8px rgba(255, 159, 10, 0.4);
    }
    .status-dot.paused {
      background: #ffd60a;
      box-shadow: 0 0 8px rgba(255, 214, 10, 0.4);
    }
    @keyframes pulse-soft {
      0%, 100% { opacity: 1; transform: scale(1); }
      50% { opacity: 0.7; transform: scale(0.95); }
    }
    @keyframes flash-success {
      0% { transform: scale(1.3); box-shadow: 0 0 12px rgba(10, 132, 255, 0.6); }
      100% { transform: scale(1); box-shadow: 0 0 8px rgba(10, 132, 255, 0.4); }
    }
    @keyframes flash-error {
      0% { transform: scale(1.3); box-shadow: 0 0 12px rgba(255, 69, 58, 0.6); }
      100% { transform: scale(1); box-shadow: 0 0 8px rgba(255, 69, 58, 0.4); }
    }
    @keyframes spin {
      from { transform: rotate(0deg); }
      to { transform: rotate(360deg); }
    }
    .status-text { font-size: 12px; color: rgba(255, 255, 255, 0.6); font-weight: 500; }

    .header-actions { display: flex; gap: 2px; }
    .icon-btn {
      width: 26px;
      height: 26px;
      display: flex;
      align-items: center;
      justify-content: center;
      background: transparent;
      border: none;
      border-radius: 6px;
      color: rgba(255, 255, 255, 0.5);
      cursor: pointer;
      transition: all 0.15s ease, transform 0.1s ease;
    }
    .icon-btn:hover { background: rgba(255, 255, 255, 0.1); color: #fff; }
    .icon-btn:active { transform: scale(0.92); }

    .input-area { display: flex; gap: 8px; padding: 0 12px 12px; }
    #instruction-input {
      flex: 1;
      height: 38px;
      padding: 0 12px;
      background: rgba(255, 255, 255, 0.08);
      border: 1px solid rgba(255, 255, 255, 0.1);
      border-radius: 8px;
      color: #fff;
      font-size: 14px;
      outline: none;
      transition: background-color 0.15s ease, border-color 0.15s ease, box-shadow 0.2s ease;
    }
    #instruction-input::placeholder {
      color: rgba(255, 255, 255, 0.35);
      transition: opacity 0.2s ease;
    }
    #instruction-input:focus {
      background: rgba(255, 255, 255, 0.12);
      border-color: rgba(10, 132, 255, 0.5);
      box-shadow: 0 0 0 3px rgba(10, 132, 255, 0.15);
    }
    #instruction-input:focus::placeholder { opacity: 0.6; }
    #instruction-input.shake { animation: shake 0.4s ease-out; }
    @keyframes shake {
      0%, 100% { transform: translateX(0); }
      20% { transform: translateX(-6px); }
      40% { transform: translateX(5px); }
      60% { transform: translateX(-4px); }
      80% { transform: translateX(2px); }
    }
    .submit-btn {
      width: 38px;
      height: 38px;
      display: flex;
      align-items: center;
      justify-content: center;
      background: #0a84ff;
      border: none;
      border-radius: 8px;
      color: #fff;
      cursor: pointer;
      transition: background-color 0.15s ease, transform 0.1s ease, opacity 0.2s ease;
    }
    .submit-btn:hover { background: #409cff; transform: scale(1.02); }
    .submit-btn:active { transform: scale(0.97); }
    .submit-btn:disabled { opacity: 0.4; cursor: not-allowed; transform: none; }
    .submit-btn.loading { pointer-events: none; }
    .submit-btn.loading svg { animation: spin 0.8s linear infinite; }

    .metrics-bar {
      display: flex;
      justify-content: space-around;
      padding: 8px 12px;
      background: rgba(0, 0, 0, 0.2);
      border-top: 1px solid rgba(255, 255, 255, 0.06);
    }
    .metric { display: flex; flex-direction: column; align-items: center; gap: 1px; }
    .metric-label { font-size: 9px; color: rgba(255, 255, 255, 0.4); text-transform: uppercase; letter-spacing: 0.5px; }
    .metric-value {
      font-size: 12px;
      font-weight: 600;
      color: rgba(255, 255, 255, 0.8);
      font-variant-numeric: tabular-nums;
      transition: color 0.2s ease;
    }
    .metric-value.updated { animation: metric-pulse 0.3s ease-out; }
    @keyframes metric-pulse {
      0% { color: #0a84ff; transform: scale(1.05); }
      100% { color: rgba(255, 255, 255, 0.8); transform: scale(1); }
    }

    .action-timeline {
      padding: 10px 12px;
      max-height: 120px;
      display: flex;
      flex-direction: column;
      overflow: hidden;
    }
    .timeline-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 6px;
    }
    .action-label { font-size: 9px; color: rgba(255, 255, 255, 0.4); text-transform: uppercase; letter-spacing: 0.5px; }
    .action-count {
      font-size: 9px;
      color: rgba(255, 255, 255, 0.4);
    }
    .timeline-list {
      flex: 1;
      overflow-y: auto;
      display: flex;
      flex-direction: column;
      gap: 4px;
    }
    .timeline-item {
      display: flex;
      align-items: flex-start;
      gap: 8px;
      font-size: 11px;
      padding: 4px 0;
      border-bottom: 1px solid rgba(255, 255, 255, 0.05);
      animation: action-slide-in 0.25s ease-out;
    }
    .timeline-item:last-child {
      border-bottom: none;
    }
    @keyframes action-slide-in {
      from { opacity: 0; transform: translateX(-8px); }
      to { opacity: 1; transform: translateX(0); }
    }
    .timeline-time {
      font-size: 9px;
      color: rgba(255, 255, 255, 0.4);
      white-space: nowrap;
      min-width: 45px;
    }
    .timeline-action {
      color: rgba(255, 255, 255, 0.6);
      line-height: 1.3;
      flex: 1;
      display: flex;
      align-items: center;
      gap: 6px;
      transition: color 0.2s ease;
    }
    .timeline-item.error .timeline-action {
      color: #ff453a;
    }
    .timeline-empty {
      font-size: 11px;
      color: rgba(255, 255, 255, 0.4);
      text-align: center;
      padding: 8px 0;
    }

    .action-icon {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      width: 16px;
      height: 16px;
      color: rgba(255, 255, 255, 0.5);
      flex-shrink: 0;
    }
    .action-icon svg { width: 12px; height: 12px; }
    .action-icon.click { color: #0a84ff; }
    .action-icon.double_click { color: #5e5ce6; }
    .action-icon.move { color: #64d2ff; }
    .action-icon.type { color: #30d158; }
    .action-icon.key { color: #ffd60a; }
    .action-icon.scroll { color: #bf5af2; }
    .action-icon.drag { color: #ff9f0a; }
    .action-icon.batch { color: #ac8e68; }
    .action-icon.complete { color: #30d158; }
    .action-icon.error { color: #ff453a; }
    .action-icon.default { color: rgba(255, 255, 255, 0.5); }
    .action-text { flex: 1; }

    .stop-btn {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 6px;
      width: calc(100% - 24px);
      margin: 0 12px 12px;
      padding: 8px;
      background: rgba(255, 69, 58, 0.9);
      border: none;
      border-radius: 8px;
      color: #fff;
      font-size: 12px;
      font-weight: 600;
      cursor: pointer;
      transition: background-color 0.15s ease, transform 0.1s ease;
    }
    .stop-btn:hover { background: #ff453a; }
    .stop-btn:active { transform: scale(0.97); }

    /* Settings Panel */
    .settings-panel {
      position: absolute;
      top: 10px;
      left: 0;
      right: 0;
      margin: 0 auto;
      max-width: 380px;
      max-height: calc(100vh - 20px);
      background: rgba(30, 30, 30, 0.9);
      -webkit-backdrop-filter: blur(40px) saturate(180%);
      backdrop-filter: blur(40px) saturate(180%);
      border-radius: 12px;
      border: 1px solid rgba(255, 255, 255, 0.15);
      box-shadow: 0 20px 40px rgba(0, 0, 0, 0.4);
      display: flex;
      flex-direction: column;
      overflow: hidden;
      animation: slide-in-top 0.25s ease-out;
      transform-origin: top center;
    }
    .settings-panel.hidden { display: none; }
    @keyframes slide-in-top {
      from { opacity: 0; transform: translateY(-12px) scale(0.98); }
      to { opacity: 1; transform: translateY(0) scale(1); }
    }
    .settings-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 12px;
      border-bottom: 1px solid rgba(255, 255, 255, 0.08);
    }
    .settings-header h2 { font-size: 14px; font-weight: 600; }
    .settings-content { flex: 1; overflow-y: auto; padding: 12px; }
    .setting-group {
      margin-bottom: 14px;
      animation: stagger-in 0.3s ease-out backwards;
    }
    .setting-group:nth-child(1) { animation-delay: 0.05s; }
    .setting-group:nth-child(2) { animation-delay: 0.1s; }
    .setting-group:nth-child(3) { animation-delay: 0.15s; }
    .setting-group:nth-child(4) { animation-delay: 0.2s; }
    @keyframes stagger-in {
      from { opacity: 0; transform: translateY(8px); }
      to { opacity: 1; transform: translateY(0); }
    }
    .setting-label { display: block; font-size: 10px; color: rgba(255, 255, 255, 0.5); margin-bottom: 5px; text-transform: uppercase; letter-spacing: 0.5px; }
    .setting-input, .setting-select {
      width: 100%;
      height: 34px;
      padding: 0 10px;
      background: rgba(255, 255, 255, 0.08);
      border: 1px solid rgba(255, 255, 255, 0.1);
      border-radius: 6px;
      color: #fff;
      font-size: 13px;
      outline: none;
      transition: background-color 0.15s ease, border-color 0.15s ease, box-shadow 0.2s ease;
    }
    .setting-input::placeholder {
      color: rgba(255, 255, 255, 0.3);
      transition: opacity 0.2s ease;
    }
    .setting-input:focus, .setting-select:focus {
      border-color: rgba(10, 132, 255, 0.5);
      background: rgba(255, 255, 255, 0.12);
      box-shadow: 0 0 0 3px rgba(10, 132, 255, 0.15);
    }
    .setting-input:focus::placeholder { opacity: 0.6; }
    .setting-select { cursor: pointer; appearance: none; }
    .setting-checkbox { display: flex; align-items: center; gap: 8px; cursor: pointer; font-size: 13px; color: rgba(255, 255, 255, 0.8); }
    .setting-checkbox input { width: 16px; height: 16px; accent-color: #0a84ff; }
    .setting-hint { font-size: 10px; color: rgba(255, 255, 255, 0.4); margin-top: 4px; }
    .provider-settings { padding: 10px; background: rgba(0, 0, 0, 0.2); border-radius: 8px; margin-bottom: 14px; }
    .provider-settings .setting-group:last-child { margin-bottom: 0; }
    .save-btn {
      width: 100%;
      padding: 10px;
      background: #0a84ff;
      border: none;
      border-radius: 8px;
      color: #fff;
      font-size: 13px;
      font-weight: 600;
      cursor: pointer;
      margin-top: 6px;
      transition: background-color 0.15s ease, transform 0.1s ease;
    }
    .save-btn:hover { background: #409cff; }
    .save-btn:active { transform: scale(0.97); }

    .confirmation-dialog {
      position: fixed;
      top: 0; left: 0; right: 0; bottom: 0;
      background: rgba(0, 0, 0, 0.6);
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 100;
      animation: fade-in 0.2s ease-out;
    }
    .confirmation-dialog.hidden { display: none; }
    @keyframes fade-in {
      from { opacity: 0; }
      to { opacity: 1; }
    }
    .confirmation-content {
      background: rgba(40, 40, 40, 0.95);
      -webkit-backdrop-filter: blur(20px);
      backdrop-filter: blur(20px);
      border-radius: 12px;
      border: 1px solid rgba(255, 255, 255, 0.1);
      padding: 20px;
      max-width: 280px;
      text-align: center;
      animation: scale-fade-in 0.25s ease-out;
    }
    @keyframes scale-fade-in {
      from { opacity: 0; transform: scale(0.95); }
      to { opacity: 1; transform: scale(1); }
    }
    .confirmation-content h3 { font-size: 15px; margin-bottom: 8px; }
    .confirmation-content p { font-size: 12px; color: rgba(255, 255, 255, 0.6); margin-bottom: 16px; }
    .confirmation-actions { display: flex; gap: 8px; justify-content: center; }
    .btn { padding: 8px 16px; border-radius: 6px; border: none; font-size: 12px; font-weight: 600; cursor: pointer; transition: background-color 0.15s ease, transform 0.1s ease; }
    .btn:active { transform: scale(0.97); }
    .btn-cancel { background: rgba(255, 255, 255, 0.1); color: #fff; }
    .btn-cancel:hover { background: rgba(255, 255, 255, 0.15); }
    .btn-confirm { background: #0a84ff; color: #fff; }
    .btn-confirm:hover { background: #409cff; }

    ::-webkit-scrollbar { width: 4px; }
    ::-webkit-scrollbar-track { background: transparent; }
    ::-webkit-scrollbar-thumb { background: rgba(255, 255, 255, 0.2); border-radius: 2px; }

    /* Toast notifications */
    .toast {
      position: fixed;
      bottom: 20px;
      left: 50%;
      transform: translateX(-50%);
      padding: 10px 16px;
      background: rgba(50, 50, 50, 0.95);
      -webkit-backdrop-filter: blur(20px);
      backdrop-filter: blur(20px);
      border-radius: 8px;
      border: 1px solid rgba(255, 255, 255, 0.1);
      font-size: 12px;
      color: #fff;
      z-index: 200;
      animation: toast-in 0.3s ease-out;
    }
    .toast.success { border-color: rgba(50, 215, 75, 0.3); }
    .toast.error { border-color: rgba(255, 69, 58, 0.3); color: #ff6961; }
    .toast.info { border-color: rgba(255, 159, 10, 0.3); color: #ffb84d; }
    .toast.hiding { animation: toast-out 0.25s ease-in forwards; }
    @keyframes toast-in {
      from { opacity: 0; transform: translate(-50%, 12px); }
      to { opacity: 1; transform: translate(-50%, 0); }
    }
    @keyframes toast-out {
      from { opacity: 1; transform: translate(-50%, 0); }
      to { opacity: 0; transform: translate(-50%, -8px); }
    }

    /* Stop button fade in/out */
    .stop-btn {
      animation: fade-slide-in 0.2s ease-out;
    }
    @keyframes fade-slide-in {
      from { opacity: 0; transform: translateY(4px); }
      to { opacity: 1; transform: translateY(0); }
    }

    /* Reduced motion preference */
    @media (prefers-reduced-motion: reduce) {
      *,
      *::before,
      *::after {
        animation-duration: 0.01ms !important;
        animation-iteration-count: 1 !important;
        transition-duration: 0.01ms !important;
      }
      /* Keep essential state visibility without motion */
      .status-dot.running { box-shadow: 0 0 6px rgba(50, 215, 75, 0.5); }
      .status-dot.error { box-shadow: 0 0 6px rgba(255, 69, 58, 0.5); }
      .status-dot.completed { box-shadow: 0 0 6px rgba(10, 132, 255, 0.5); }
      .status-dot.retrying { box-shadow: 0 0 6px rgba(255, 159, 10, 0.5); }
      .status-dot.paused { box-shadow: 0 0 6px rgba(255, 214, 10, 0.5); }
      .submit-btn.loading svg { animation: none !important; opacity: 0.6; }
    }

    /* Expandable Mode */
    .expanded-only { display: none !important; }

    .modal.expanded .expanded-only { display: flex !important; }

    .modal {
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    }

    .modal.expanded {
      max-width: 480px;
    }

    .modal.expanded .input-area {
      padding-bottom: 16px;
    }

    .modal.expanded #instruction-input {
      height: 44px;
    }

    .modal.expanded .submit-btn {
      width: 44px;
      height: 44px;
    }

    .modal.expanded .metrics-bar {
      flex-wrap: wrap;
      gap: 8px;
      padding: 12px 16px;
    }

    .modal.expanded .metric {
      min-width: 60px;
    }

    .modal.expanded .action-display {
      padding: 14px 16px;
    }

    .modal.expanded .action-content {
      max-height: 60px;
      font-size: 12px;
    }

    /* Action History (expanded only) */
    .action-history {
      padding: 0 16px 14px;
      border-top: 1px solid rgba(255, 255, 255, 0.06);
      flex-direction: column;
    }

    .action-history .action-label {
      padding-top: 10px;
      padding-bottom: 6px;
    }

    .action-history-list {
      max-height: 120px;
      overflow-y: auto;
      display: flex;
      flex-direction: column;
      gap: 4px;
    }

    .action-history-item {
      font-size: 11px;
      color: rgba(255, 255, 255, 0.5);
      padding: 4px 8px;
      background: rgba(255, 255, 255, 0.04);
      border-radius: 4px;
      line-height: 1.3;
    }

    .action-history-item:first-child {
      color: rgba(255, 255, 255, 0.7);
      background: rgba(255, 255, 255, 0.08);
    }

    /* Expand button active state */
    #expand-btn.active {
      background: rgba(10, 132, 255, 0.2);
      color: #0a84ff;
    }

    /* Transition animations for content */
    .action-history,
    .modal.expanded .action-display,
    .metrics-bar .metric {
      transition: opacity 0.2s ease-in-out;
    }

    .modal:not(.expanded) .expanded-only {
      opacity: 0;
    }

    .modal.expanded .expanded-only {
      opacity: 1;
    }
  </style>
</head>
<body>
  <div id="app">
    <div class="modal" id="main-modal" role="main">
      <div class="drag-handle" data-tauri-drag-region aria-hidden="true"></div>
      <div class="modal-header">
        <div class="status-indicator" role="status" aria-live="polite" aria-atomic="true">
          <svg class="pia-logo" viewBox="0 0 512 512" xmlns="http://www.w3.org/2000/svg" aria-hidden="true">
            <rect x="0" y="0" width="512" height="512" rx="90" ry="90" fill="#e0e7ff"/>
            <rect x="86" y="100" width="340" height="312" rx="60" ry="60" fill="#818cf8"/>
            <ellipse cx="180" cy="180" rx="80" ry="50" fill="#a5b4fc" opacity="0.5"/>
            <ellipse cx="175" cy="260" rx="42" ry="50" fill="white"/>
            <ellipse cx="337" cy="260" rx="42" ry="50" fill="white"/>
            <circle cx="185" cy="252" r="24" fill="#1e1b4b"/>
            <circle cx="347" cy="252" r="24" fill="#1e1b4b"/>
            <circle cx="195" cy="242" r="8" fill="white"/>
            <circle cx="357" cy="242" r="8" fill="white"/>
            <ellipse cx="105" cy="320" rx="30" ry="22" fill="#f9a8d4" opacity="0.7"/>
            <ellipse cx="407" cy="320" rx="30" ry="22" fill="#f9a8d4" opacity="0.7"/>
            <path d="M200 355 Q256 420 312 355" stroke="#1e1b4b" stroke-width="10" fill="none" stroke-linecap="round"/>
            <line x1="256" y1="100" x2="256" y2="40" stroke="#818cf8" stroke-width="10" stroke-linecap="round"/>
            <circle cx="256" cy="28" r="28" fill="#f472b6"/>
            <circle cx="256" cy="28" r="14" fill="#fbcfe8"/>
            <circle cx="55" cy="180" r="35" fill="#818cf8"/>
            <circle cx="55" cy="180" r="18" fill="#c7d2fe"/>
            <circle cx="457" cy="180" r="35" fill="#818cf8"/>
            <circle cx="457" cy="180" r="18" fill="#c7d2fe"/>
          </svg>
          <span class="status-dot" aria-hidden="true"></span>
          <span class="status-text">Ready</span>
        </div>
        <div class="header-actions">
          <button class="icon-btn" id="expand-btn" title="Expand" aria-label="Expand/collapse window">
            <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" aria-hidden="true">
              <polyline points="15 3 21 3 21 9"></polyline>
              <polyline points="9 21 3 21 3 15"></polyline>
              <line x1="21" y1="3" x2="14" y2="10"></line>
              <line x1="3" y1="21" x2="10" y2="14"></line>
            </svg>
          </button>
          <button class="icon-btn" id="settings-btn" title="Settings" aria-label="Open settings" aria-expanded="false">
            <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" aria-hidden="true">
              <circle cx="12" cy="12" r="3"></circle>
              <path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z"></path>
            </svg>
          </button>
          <button class="icon-btn" id="close-btn" title="Hide" aria-label="Hide window">
            <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" aria-hidden="true">
              <line x1="18" y1="6" x2="6" y2="18"></line>
              <line x1="6" y1="6" x2="18" y2="18"></line>
            </svg>
          </button>
        </div>
      </div>
      <div class="input-area">
        <label for="instruction-input" class="visually-hidden">Enter instruction for the agent</label>
        <input type="text" id="instruction-input" placeholder="What would you like me to do?" autocomplete="off" aria-describedby="metrics-bar">
        <button class="submit-btn" id="submit-btn" aria-label="Send instruction">
          <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" aria-hidden="true">
            <line x1="22" y1="2" x2="11" y2="13"></line>
            <polygon points="22 2 15 22 11 13 2 9 22 2"></polygon>
          </svg>
        </button>
      </div>
      <div class="metrics-bar" id="metrics-bar" role="group" aria-label="Agent metrics">
        <div class="metric">
          <span class="metric-label" id="iteration-label">Iteration</span>
          <span class="metric-value" id="iteration-value" aria-labelledby="iteration-label">0/50</span>
        </div>
        <div class="metric">
          <span class="metric-label" id="speed-label">Speed</span>
          <span class="metric-value" id="speed-value" aria-labelledby="speed-label">--</span>
        </div>
        <div class="metric">
          <span class="metric-label" id="tokens-label">Tokens</span>
          <span class="metric-value" id="tokens-value" aria-labelledby="tokens-label">0</span>
        </div>
        <div class="metric expanded-only">
          <span class="metric-label">Elapsed</span>
          <span class="metric-value" id="elapsed-value">0:00</span>
        </div>
        <div class="metric expanded-only">
          <span class="metric-label">Actions</span>
          <span class="metric-value" id="actions-count">0</span>
        </div>
      </div>
      <div class="action-timeline" aria-live="polite" aria-atomic="true">
        <div class="timeline-header">
          <span class="action-label">Action History</span>
          <span class="action-count" id="action-count">0 actions</span>
        </div>
        <div class="timeline-list" id="timeline-list">
          <div class="timeline-empty">Waiting for instruction...</div>
        </div>
      </div>
      <div class="action-history expanded-only">
        <div class="action-label">Action History</div>
        <div class="action-history-list" id="action-history-list"></div>
      </div>
      <button class="stop-btn hidden" id="stop-btn" aria-label="Stop agent">
        <svg width="12" height="12" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true"><rect x="6" y="6" width="12" height="12" rx="2"></rect></svg>
        Stop
      </button>
    </div>

    <div class="settings-panel hidden" id="settings-panel" role="region" aria-label="Settings" aria-labelledby="settings-title">
      <div class="settings-header">
        <h2 id="settings-title">Settings</h2>
        <button class="icon-btn" id="settings-close-btn" aria-label="Close settings">
          <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" aria-hidden="true">
            <line x1="18" y1="6" x2="6" y2="18"></line>
            <line x1="6" y1="6" x2="18" y2="18"></line>
          </svg>
        </button>
      </div>
      <div class="settings-content">
        <div class="setting-group">
          <label class="setting-label">Provider</label>
          <select id="provider-select" class="setting-select">
            <option value="ollama">Ollama (Local)</option>
            <option value="anthropic">Anthropic</option>
            <option value="openai">OpenAI</option>
            <option value="openrouter">OpenRouter</option>
          </select>
        </div>
        <div class="provider-settings" id="ollama-settings">
          <div class="setting-group">
            <label class="setting-label">Host</label>
            <input type="text" id="ollama-host" class="setting-input" placeholder="http://localhost:11434">
          </div>
          <div class="setting-group">
            <label class="setting-label">Model</label>
            <input type="text" id="ollama-model" class="setting-input" placeholder="llava">
          </div>
        </div>
        <div class="provider-settings hidden" id="anthropic-settings">
          <div class="setting-group">
            <label class="setting-label">API Key</label>
            <input type="password" id="anthropic-key" class="setting-input" placeholder="sk-ant-...">
          </div>
          <div class="setting-group">
            <label class="setting-label">Model</label>
            <input type="text" id="anthropic-model" class="setting-input" placeholder="claude-sonnet-4-20250514">
          </div>
        </div>
        <div class="provider-settings hidden" id="openai-settings">
          <div class="setting-group">
            <label class="setting-label">API Key</label>
            <input type="password" id="openai-key" class="setting-input" placeholder="sk-...">
          </div>
          <div class="setting-group">
            <label class="setting-label">Model</label>
            <input type="text" id="openai-model" class="setting-input" placeholder="gpt-4o">
          </div>
        </div>
        <div class="provider-settings hidden" id="openrouter-settings">
          <div class="setting-group">
            <label class="setting-label">API Key</label>
            <input type="password" id="openrouter-key" class="setting-input" placeholder="sk-or-...">
          </div>
          <div class="setting-group">
            <label class="setting-label">Model</label>
            <input type="text" id="openrouter-model" class="setting-input" placeholder="anthropic/claude-sonnet-4-20250514">
          </div>
        </div>
        <div class="setting-group">
          <label class="setting-label">Max Iterations</label>
          <input type="number" id="max-iterations" class="setting-input" placeholder="50" min="1" max="200" value="50">
          <p class="setting-hint">Maximum number of agent iterations per task (1-200)</p>
        </div>
        <div class="setting-group">
          <label class="setting-label">Global Hotkey</label>
          <div style="display: flex; gap: 8px;">
            <input type="text" id="global-hotkey-input" class="setting-input" placeholder="CmdOrCtrl+Shift+P" style="flex: 1;">
            <button class="icon-btn" id="clear-hotkey-btn" title="Disable hotkey" style="width: 34px; height: 34px; background: rgba(255, 255, 255, 0.08); border: 1px solid rgba(255, 255, 255, 0.1);">
              <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <line x1="18" y1="6" x2="6" y2="18"></line>
                <line x1="6" y1="6" x2="18" y2="18"></line>
              </svg>
            </button>
          </div>
          <p class="setting-hint">Summon Pia from anywhere (e.g., CmdOrCtrl+Shift+P)</p>
          <p class="setting-hint" id="hotkey-error" style="color: #ff453a; display: none;"></p>
        </div>
        <div class="setting-group">
          <label class="setting-checkbox">
            <input type="checkbox" id="confirm-dangerous" checked>
            <span>Confirm dangerous actions</span>
          </label>
          <p class="setting-hint">Ask before delete/close operations</p>
        </div>
        <div class="setting-group">
          <label class="setting-checkbox">
            <input type="checkbox" id="show-overlay">
            <span>Show coordinate overlay</span>
          </label>
          <p class="setting-hint">Display crosshair at target coordinates (debug)</p>
        </div>
        <button class="save-btn" id="save-settings-btn">Save</button>
      </div>
    </div>

    <div class="confirmation-dialog hidden" id="confirmation-dialog" role="dialog" aria-modal="true" aria-labelledby="confirmation-title" aria-describedby="confirmation-message">
      <div class="confirmation-content">
        <h3 id="confirmation-title">Confirm Action</h3>
        <p id="confirmation-message">This action requires confirmation.</p>
        <div class="confirmation-actions">
          <button class="btn btn-cancel" id="cancel-action-btn">Cancel</button>
          <button class="btn btn-confirm" id="confirm-action-btn">Confirm</button>
        </div>
      </div>
    </div>
  </div>
  <script type="module" src="./src/main.js"></script>
</body>
</html>
